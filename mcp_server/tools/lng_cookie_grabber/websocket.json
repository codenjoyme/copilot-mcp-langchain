{
  "operation": "server_start",
  "name": "cookie-websocket-server",
  "port": 9001,
  "path": "/ws",
  "bind_host": "localhost",
  "protocol": "ws",
  "max_connections": 100,
  "connection_handling": {
    "heartbeat_enabled": true,
    "heartbeat_interval": 30,
    "heartbeat_message": {
      "type": "ping",
      "message": "Ping",
      "version": "Version: 5"
    },
    "auto_cleanup": true
  },
  "event_handlers": {
    "on_connect": [
      {
        "tool": "lng_file_write",
        "params": {
          "file_path": "mcp_server/logs/websocket/cookie-websocket-server.log",
          "content": "[{! new Date().toISOString() !}] CONNECT: Client {! websocket.client_id !} connected from {! websocket.remote_ip !}\n",
          "mode": "append"
        }
      }
    ],
    "on_message": [
      {
        "tool": "lng_file_write",
        "params": {
          "file_path": "mcp_server/logs/websocket/cookie-websocket-server.log",
          "content": "[{! new Date().toISOString() !}] RAW MESSAGE: Client={! websocket.client_id !} Type={! typeof websocket.message.content !} Length={! websocket.message.content.length !}\nContent: {! websocket.message.content !}\n--- END RAW ---\n\n",
          "mode": "append"
        }
      },
      {
        "type": "condition",
        "condition": "{! websocket.message.content === 'Pong' !}",
        "then": [
          {
            "tool": "lng_file_write",
            "params": {
              "file_path": "mcp_server/logs/websocket/cookie-websocket-server.log",
              "content": "[{! new Date().toISOString() !}] PONG: Received from {! websocket.client_id !}\n",
              "mode": "append"
            }
          }
        ],
        "else": [
          {
            "tool": "lng_file_write",
            "params": {
              "file_path": "mcp_server/logs/websocket/cookie-websocket-server.log",
              "content": "[{! new Date().toISOString() !}] COOKIES: Session={! websocket.query.sessionId || 'unknown' !} Client={! websocket.client_id !}\n{! websocket.message.content !}\n--- END COOKIES ---\n\n",
              "mode": "append"
            }
          }
        ]
      }
    ],
    "on_disconnect": [
      {
        "tool": "lng_file_write",
        "params": {
          "file_path": "mcp_server/logs/websocket/cookie-websocket-server.log",
          "content": "[{! new Date().toISOString() !}] DISCONNECT: Client {! websocket.client_id !} disconnected\n",
          "mode": "append"
        }
      }
    ]
  }
}
